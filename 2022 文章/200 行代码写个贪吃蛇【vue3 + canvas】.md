
â€œæˆ‘æ­£åœ¨å‚åŠ ã€Œåˆ›æ„å¼€å‘ æŠ•ç¨¿å¤§èµ›ã€è¯¦æƒ…è¯·çœ‹ï¼š[æ˜é‡‘åˆ›æ„å¼€å‘å¤§èµ›æ¥äº†ï¼](https://juejin.cn/post/7120441631530549284 "https://juejin.cn/post/7120441631530549284")â€

## å‰è¨€

è´ªåƒè›‡ä½œä¸ºä¸€ä¸ªç»å…¸çš„å°æ¸¸æˆï¼Œæ˜¯å¾ˆå¤šäººå„¿æ—¶çš„è®°å¿†ï¼Œå½“æ—¶çš„æŒæœºã€è¯ºåŸºäºšæ‰‹æœºé‡Œé¢éƒ½æœ‰å®ƒçš„èº«å½±ï¼Œéšç€æ—¶é—´æµé€ï¼Œå½“å¹´çš„æˆ‘ä»¬å·²ç»å˜æˆå¤§äººæ¨¡æ ·ï¼Œç©ç€ç‹è€…ï¼Œåƒé¸¡ç­‰å¤§å‹æ¸¸æˆï¼›è´ªåƒè›‡è¿™ç§å°æ¸¸æˆå·²ç»åŠä¸èµ·æˆ‘ä»¬çš„å…´è¶£äº†ï¼Œä¸è¿‡å¦‚æœä½ æ˜¯ä¸€åç¨‹åºå‘˜ï¼Œé‚£è¿˜æ˜¯å»ºè®®å®ç°ä¸€ä¸‹ï¼Œæ¯•ç«Ÿä½œä¸º leetcode 353 ç®—æ³•é¢˜ä½ æ€»ä¸æƒ³åœ¨é¢è¯•çš„æ—¶å€™é‡åˆ°å®ƒå´ä¸ä¼šå§ã€‚

æœ¬æ–‡è®©æˆ‘ä»¬æ¥å¤åˆ»ä¸€ä¸‹è¿™æ¬¾ç»å…¸çš„å°æ¸¸æˆå§

[åœ¨çº¿åœ°å€](https://l8idb0.csb.app/)

[![image.png](https://camo.githubusercontent.com/c45af49472e7f4d0c577d29e287c5a6419aa5bf77bbe884c5820d69a13815558/68747470733a2f2f70312d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f32626632376236656231643734303364383138386630366634373464666334637e74706c762d6b3375316662706663702d77617465726d61726b2e696d6167653f)](https://camo.githubusercontent.com/c45af49472e7f4d0c577d29e287c5a6419aa5bf77bbe884c5820d69a13815558/68747470733a2f2f70312d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f32626632376236656231643734303364383138386630366634373464666334637e74706c762d6b3375316662706663702d77617465726d61726b2e696d6167653f)

## è§„åˆ™

ç©æ³•ï¼šç©å®¶ä½¿ç”¨æ–¹å‘é”®æ“æ§ä¸€æ¡é•¿é•¿çš„è›‡ä¸æ–­åä¸‹è±†å­ï¼ŒåŒæ—¶è›‡èº«éšç€åä¸‹çš„è±†å­ä¸æ–­å˜é•¿ï¼Œå½“è›‡å¤´æ’åˆ°è›‡èº«æˆ–éšœå£æ—¶æ¸¸æˆç»“æŸã€‚

## æ€è·¯

`å…ƒç´ `ï¼šè¾¹ç•Œã€è›‡å¤´ã€è›‡èº«ã€é£Ÿç‰©

`è¾¹ç•Œ`ï¼šè¾“å…¥ è¡Œæ•° x, åˆ—æ•° y ç”Ÿæˆè¾¹ç•Œåœ°å›¾ï¼Œç”¨äºŒç»´åæ ‡æ ‡è¯†æ¯ä¸ªç‚¹çš„ä½ç½®ï¼›

`è›‡å¤´ã€è›‡èº«`ï¼šè›‡å¤´å’Œè›‡èº«åˆ†ç¦»ï¼Œå½“åƒåˆ°é£Ÿç‰©åï¼Œè›‡èº«å°¾éƒ¨åŠ ä¸€

`é£Ÿç‰©`ï¼šä½ç½®éšæœºç”Ÿæˆï¼›

## æµç¨‹å›¾

[![image.png](https://camo.githubusercontent.com/f53724aac66e9fbf08ce5162663c1f5a471e85c6f1e99d2368c0e1334fb8087d/68747470733a2f2f70362d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f32363536616466653537633234333234613963633765386661383333666564357e74706c762d6b3375316662706663702d77617465726d61726b2e696d6167653f)](https://camo.githubusercontent.com/f53724aac66e9fbf08ce5162663c1f5a471e85c6f1e99d2368c0e1334fb8087d/68747470733a2f2f70362d6a75656a696e2e62797465696d672e636f6d2f746f732d636e2d692d6b3375316662706663702f32363536616466653537633234333234613963633765386661383333666564357e74706c762d6b3375316662706663702d77617465726d61726b2e696d6167653f)

## ä»£ç å®ç°

### æŠ€æœ¯æ ˆ

é€‰æ‹©Â `vue3ã€vite`Â åŸºç¡€æ¶æ„ï¼›  
è§†å›¾é€‰ç”¨Â `canvas`Â æŠ€æœ¯æ¥å®ç°ï¼Œç›¸æ¯” dom æ¥è¯´æ€§èƒ½æ›´å¥½ï¼›

### åŸºæœ¬å˜é‡å®šä¹‰

<script setup lang="ts">
  import { ref, onMounted } from 'vue'
  
  let width = ref(600) // åœ°å›¾é»˜è®¤å®½åº¦
  let height = ref(400) // åœ°å›¾é»˜è®¤é«˜åº¦
  let canvas: any = null // canvas å¯¹è±¡
  let ctx: any = null // canvas æ¸²æŸ“ä¸Šä¸‹æ–‡å¯¹è±¡
  let snakeList = [[0, 100], [10, 100],] // è›‡çš„ç‚¹ä½åæ ‡
  let direction = 'right' // top | down | left | right // å½“å‰æ–¹å‘
  let elementWidth = 10 // å…ƒç´ å°ºå¯¸
  let step = 10 // é€Ÿåº¦
  let store = ref(0) // åˆ†æ•°
  let status = ref('start') // unStart | start | pause ï½œ over | success(é€šå…³) // çŠ¶æ€
  let foodCoordinate: any = [
    ((Math.random() * width.value) / 10) | 0,
    ((Math.random() * height.value) / 10) | 0,
  ] // é£Ÿç‰©åæ ‡
  let process: any = null // å®šæ—¶å™¨ Id
</script>

### åˆå§‹åŒ–

åœ¨ onMounted é‡Œæ‰§è¡Œï¼Œä¸»è¦åš åœ°å›¾ç»˜åˆ¶ã€é¼ æ ‡åæ ‡æ£€æµ‹ã€æ–¹å‘ç›‘æµ‹ã€é£Ÿç‰©ç»˜åˆ¶ã€å®šæ—¶å™¨å¯ç”¨ç­‰æ“ä½œã€‚

function handleInit() {
  canvas = document.getElementById('canvas')

  if (canvas?.getContext) {
    ctx = canvas?.getContext('2d')

    canvas.addEventListener('mousemove', e => {
      ctx.clearRect(10, height.value - 20, 120, 40)
      ctx.fillText(`å½“å‰é¼ æ ‡ä½ç½®ï¼š${e.offsetX}, ${e.offsetY}`, 10, height.value - 10)
    })

    document.addEventListener('keydown', e => {
      e.preventDefault()

      if (Direction[e.keyCode]) {
        direction = Direction[e.keyCode]
      }
    })

    process = setInterval(handleRenderSnake, 150)
    handleRenderFood()
    // window.requestAnimationFrame(handleRenderSnake)
  } else {
    alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ canvas')
  }
}

### é£Ÿç‰©ç»˜åˆ¶

å½“é£Ÿç‰©è¢«åƒæ‰åï¼Œéœ€è¦é”€æ¯å’Œé‡æ–°ç”Ÿæˆ

// ç»˜åˆ¶é£Ÿç‰©
function handleRenderFood() {
  ctx.clearRect(foodCoordinate[0], foodCoordinate[1], 10, 10)
  foodCoordinate = [(Math.random() * width.value) | 0, (Math.random() * height.value) | 0]
  ctx.fillStyle = '#eb2f96'
  ctx.fillRect(foodCoordinate[0], foodCoordinate[1], 10, 10)
}

### è›‡å¤´/è›‡èº«ç»˜åˆ¶

è›‡æ˜¯é€šè¿‡äºŒç»´æ•°ç»„æ¥è¡¨ç¤ºçš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨èº«ä½“çš„ä¸€éƒ¨åˆ†ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä»£è¡¨è›‡å¤´ï¼Œè›‡çš„ç§»åŠ¨æ˜¯é€šè¿‡ åˆ é™¤å°¾éƒ¨èŠ‚ç‚¹ï¼Œæ·»åŠ å¤´éƒ¨èŠ‚ç‚¹æ¥å®ç°ï¼Œä¸­é—´èŠ‚ç‚¹ä¸ç”¨åŠ¨ï¼Œåœ¨å››ä¸ªæ–¹å‘ä¸Šçš„å¤„ç†ç•¥æœ‰ä¸åŒã€‚  
æ³¨æ„å½“åƒåˆ°é£Ÿç‰©æ—¶ï¼Œå½“å‰å¸§å°¾éƒ¨èŠ‚ç‚¹ä¸å†åˆ é™¤ï¼Œå³å¯å®ç°è›‡èº«é•¿åº¦åŠ  1ã€‚

function handleRenderSnake() {
  switch (direction) {
    case 'top':
      if (snakeList.slice(-1)[0][1] <= 0) {
        status.value = 'over'
        return
      }

      snakeList.push([
        snakeList[snakeList.length - 1][0],
        snakeList[snakeList.length - 1][1] - step,
      ])
      handleUpdateVerify()
      break
    case 'down':
      if (snakeList.slice(-1)[0][1] >= height.value - 1) {
        status.value = 'over'
        return
      }

      snakeList.push([
        snakeList[snakeList.length - 1][0],
        snakeList[snakeList.length - 1][1] + step,
      ])
      handleUpdateVerify()

      break
      ...

### ç¢°æ’ğŸ’¥ç®—æ³•ã€è¾¹ç•Œæ¡ä»¶

å½“è›‡å¤´è§¦ç¢°åˆ°åœ°å›¾è¾¹ç¼˜ï¼Œå°† game over, åªéœ€æ ¹æ®è›‡å¤´å½“å‰åæ ‡ã€å½“å‰æ–¹å‘ï¼Œè®¡ç®—ä¸‹ä¸€æ­¥çš„åæ ‡æ˜¯å¦ä¼šè¶…å‡ºåœ°å›¾å°ºå¯¸å³å¯ã€‚

åƒåˆ°é£Ÿç‰©çš„è®¡ç®—æ–¹æ³•ï¼šåˆ†åˆ«å¯¹è›‡å¤´åæ ‡å’Œé£Ÿç‰©åæ ‡çš„ xã€y è½´è¿›è¡Œç»å¯¹å€¼è®¡ç®—ï¼Œå°äºå…ƒç´ å°ºå¯¸æ—¶è®¤ä¸ºå·²æ¥è§¦ã€‚

// æ›´æ–°æ ¡éªŒ
function handleUpdateVerify() {
  if (status.value === 'pause') {
    clearInterval(process)
  }

  if (store.value >= 100) {
    status.value = 'success'
    return
  }

  for (let i of snakeList) {
    ctx.clearRect(i[0], i[1], elementWidth, elementWidth)
  }

  let currentSnake = snakeList.slice(-1)[0]
  if (
    Math.abs(currentSnake[0] - foodCoordinate[0]) < 10 &&
    Math.abs(currentSnake[1] - foodCoordinate[1]) < 10
  ) {
    store.value++
    handleRenderFood()
  } else {
    snakeList.shift()
  }
}

### ç§¯åˆ†è®¡ç®—ã€æš‚åœï¼Œç»§ç»­ç­‰åŠŸèƒ½

å…¨å±€å˜é‡ status ä»£è¡¨å½“å‰å±€åŠ¿çš„çŠ¶æ€ï¼Œå½“ status === 'pause' æ—¶ï¼Œè§¦å‘æš‚åœæ“ä½œï¼Œåˆ é™¤ å®šæ—¶å™¨å˜é‡ï¼Œç‚¹å‡»é‡æ–°å¼€å§‹æŒ‰é’®ï¼Œç”Ÿæˆæ–°çš„å®šæ—¶å™¨ã€‚

å½“åƒåˆ°é£Ÿç‰©æ—¶ï¼Œå…¨å±€å˜é‡ store ++, åŒå‘ç»‘å®šåˆ°é¡µé¢ä¸Šæ˜¾ç¤ºï¼Œæš‚æ—¶è®¾ç½®ç§¯åˆ†è¶…è¿‡ 100 å³å¯é€šå…³ã€‚

## åè®°

é€šè¿‡æ¥è¿‘ 200è¡Œçš„ä»£ç ï¼Œå®ç°äº†è¿™æ¬¾è´ªåƒè›‡çš„æ ¸å¿ƒç©æ³•; å¦å¤–å¯¹äºåˆæ¬¡ä½¿ç”¨ vue3 å’Œ vite ä¹Ÿä¼šæœ‰ä¸€äº›å°æ”¶è·ï¼Œæ¯”å¦‚

1.  vite è‡ªå¸¦äº†Â `less sass`Â æ”¯æŒï¼Œä¸å†éœ€è¦ å®‰è£…Â `less-loader`Â äº†ï¼Œå¦‚æœå¼ºè¡Œå®‰è£… loader ç»ˆç«¯ä¼šæŠ¥è­¦å‘Šï¼›
2.  é€šè¿‡Â `ref`Â å®šä¹‰çš„å“åº”å¼å˜é‡åœ¨ Dom ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œåœ¨ js ä¸­åˆ™éœ€è¦é€šè¿‡Â `.value`Â å±æ€§è®¿é—®å’Œä¿®æ”¹ï¼Œå•¥æ—¶å€™èƒ½å†ç®€åŒ–äº›ç›´æ¥ç”¨å°±å¥½äº†ï¼›
3.  canvas ç”»çº¿æ¡çš„æ—¶å€™è§¦å‘äº† bug æ— æ„ä¸­æ˜ç™½äº† ç”»ç¬”å·¥å…·çš„åŸç†ï¼›

---

åˆé›†ï¼š[Github åšå®¢åˆé›†](https://github.com/mingjiezhou/notes/issues)